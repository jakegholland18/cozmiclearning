{% extends "layout.html" %}
{% block content %}

<style>
body {
    background: linear-gradient(135deg, #2d3561 0%, #3d2d4f 100%);
}

.profiles-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.page-header {
    background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(236, 72, 153, 0.15));
    border: 2px solid rgba(167, 139, 250, 0.4);
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 30px;
}

.page-header h1 {
    color: #e0d9ff;
    margin: 0 0 10px 0;
    font-size: 2rem;
}

.page-header p {
    color: #c4d1ff;
    margin: 0;
    opacity: 0.9;
}

.back-link {
    display: inline-block;
    padding: 10px 20px;
    background: rgba(167, 139, 250, 0.2);
    border: 2px solid rgba(167, 139, 250, 0.4);
    border-radius: 12px;
    color: #a78bfa;
    text-decoration: none;
    margin-bottom: 20px;
    transition: all 0.3s ease;
}

.back-link:hover {
    background: rgba(167, 139, 250, 0.3);
    transform: translateX(-3px);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(167, 139, 250, 0.08));
    border: 2px solid rgba(167, 139, 250, 0.3);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 900;
    color: #a78bfa;
    margin-bottom: 5px;
}

.stat-label {
    color: #c4d1ff;
    font-size: 0.95rem;
}

.chart-section {
    background: linear-gradient(135deg, rgba(167, 139, 250, 0.1), rgba(236, 72, 153, 0.1));
    border: 2px solid rgba(167, 139, 250, 0.3);
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 30px;
}

.chart-section h2 {
    color: #a78bfa;
    margin: 0 0 20px 0;
}

.learning-style-bars {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.style-bar {
    display: flex;
    align-items: center;
    gap: 15px;
}

.style-label {
    min-width: 180px;
    color: #e0d9ff;
    font-weight: 600;
}

.bar-container {
    flex: 1;
    height: 30px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    overflow: hidden;
    position: relative;
}

.bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #a78bfa, #ec4899);
    border-radius: 15px;
    transition: width 0.5s ease;
}

.bar-count {
    min-width: 40px;
    text-align: right;
    color: #a78bfa;
    font-weight: 700;
}

.students-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.student-card {
    background: linear-gradient(135deg, rgba(167, 139, 250, 0.12), rgba(236, 72, 153, 0.08));
    border: 2px solid rgba(167, 139, 250, 0.3);
    border-radius: 16px;
    padding: 20px;
    transition: all 0.3s ease;
}

.student-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(167, 139, 250, 0.3);
}

.student-card.no-profile {
    background: linear-gradient(135deg, rgba(255, 221, 85, 0.1), rgba(255, 221, 85, 0.05));
    border-color: rgba(255, 221, 85, 0.3);
}

.student-name {
    font-size: 1.2rem;
    font-weight: 700;
    color: #e0d9ff;
    margin-bottom: 15px;
}

.profile-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(167, 139, 250, 0.2);
    border: 1px solid rgba(167, 139, 250, 0.4);
    border-radius: 20px;
    color: #a78bfa;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 15px;
}

.no-profile-badge {
    background: rgba(255, 221, 85, 0.2);
    border-color: rgba(255, 221, 85, 0.4);
    color: #ffdd55;
}

.profile-details {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    color: #c4d1ff;
    font-size: 0.9rem;
    padding: 8px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
}

.detail-label {
    opacity: 0.8;
}

.detail-value {
    font-weight: 600;
    color: #a78bfa;
}

.teaching-tips {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(167, 139, 250, 0.3);
}

.teaching-tips h4 {
    color: #84ff00;
    font-size: 0.85rem;
    margin: 0 0 10px 0;
}

.tip-item {
    color: #c4d1ff;
    font-size: 0.85rem;
    margin: 6px 0;
    padding-left: 15px;
    position: relative;
}

.tip-item:before {
    content: "‚Üí";
    position: absolute;
    left: 0;
    color: #84ff00;
}

.no-profile-message {
    color: #c4d1ff;
    font-size: 0.9rem;
    opacity: 0.8;
}
</style>

<div class="profiles-container">
    <a href="/teacher/classes" class="back-link">‚Üê Back to Classes</a>

    <div class="page-header">
        <h1>üß† Learning Profiles - {{ cls.class_name }}</h1>
        <p>Understand your students' learning preferences and get personalized teaching strategies</p>
        <p style="font-size: 0.9rem; opacity: 0.85; margin-top: 8px;">
            üí° Remember: These profiles show preferences, not limitations. Encourage students to explore all learning approaches!
        </p>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ students_with_profiles }}</div>
            <div class="stat-label">Students with Profiles</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ "%.0f"|format(profile_completion_rate) }}%</div>
            <div class="stat-label">Completion Rate</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ total_students }}</div>
            <div class="stat-label">Total Students</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ learning_styles|length }}</div>
            <div class="stat-label">Learning Styles</div>
        </div>
    </div>

    {% if learning_styles %}
    <div class="chart-section">
        <h2>üìä Class Learning Preference Distribution</h2>
        <div class="learning-style-bars">
            {% set max_count = learning_styles.values()|max %}
            {% for style, count in learning_styles.items() %}
            <div class="style-bar">
                <div class="style-label">
                    {% if style == 'visual' %}üëÅÔ∏è Visual Learners
                    {% elif style == 'auditory' %}üëÇ Auditory Learners
                    {% elif style == 'kinesthetic' %}ü§∏ Kinesthetic Learners
                    {% elif style == 'reading_writing' %}üìù Reading/Writing Learners
                    {% endif %}
                </div>
                <div class="bar-container">
                    <div class="bar-fill" style="width: {{ (count / max_count * 100)|int }}%"></div>
                </div>
                <div class="bar-count">{{ count }}</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="chart-section">
        <h2>üí° Teaching Recommendations by Learning Style</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">

            {% if 'visual' in learning_styles %}
            <div style="background: rgba(167, 139, 250, 0.1); padding: 15px; border-radius: 12px; border-left: 4px solid #a78bfa;">
                <h3 style="color: #a78bfa; margin: 0 0 10px 0;">üëÅÔ∏è For Visual Learners ({{ learning_styles['visual'] }})</h3>
                <ul style="color: #c4d1ff; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                    <li>Use diagrams, charts, and visual organizers</li>
                    <li>Incorporate color-coding in materials</li>
                    <li>Show videos and demonstrations</li>
                    <li>Use PowerGrid's visual study guides</li>
                    <li>Encourage mind mapping and sketching</li>
                </ul>
            </div>
            {% endif %}

            {% if 'auditory' in learning_styles %}
            <div style="background: rgba(236, 72, 153, 0.1); padding: 15px; border-radius: 12px; border-left: 4px solid #ec4899;">
                <h3 style="color: #ec4899; margin: 0 0 10px 0;">üëÇ For Auditory Learners ({{ learning_styles['auditory'] }})</h3>
                <ul style="color: #c4d1ff; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                    <li>Include discussions and verbal explanations</li>
                    <li>Encourage reading aloud and peer teaching</li>
                    <li>Use podcasts and audio recordings</li>
                    <li>Enable text-to-speech features</li>
                    <li>Incorporate songs, rhymes, and mnemonics</li>
                </ul>
            </div>
            {% endif %}

            {% if 'kinesthetic' in learning_styles %}
            <div style="background: rgba(132, 255, 0, 0.1); padding: 15px; border-radius: 12px; border-left: 4px solid #84ff00;">
                <h3 style="color: #84ff00; margin: 0 0 10px 0;">ü§∏ For Kinesthetic Learners ({{ learning_styles['kinesthetic'] }})</h3>
                <ul style="color: #c4d1ff; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                    <li>Include hands-on activities and experiments</li>
                    <li>Allow movement breaks during lessons</li>
                    <li>Use manipulatives and physical objects</li>
                    <li>Incorporate role-play and simulations</li>
                    <li>Shorter assignments with frequent breaks</li>
                </ul>
            </div>
            {% endif %}

            {% if 'reading_writing' in learning_styles %}
            <div style="background: rgba(0, 242, 255, 0.1); padding: 15px; border-radius: 12px; border-left: 4px solid #00f2ff;">
                <h3 style="color: #00f2ff; margin: 0 0 10px 0;">üìù For Reading/Writing Learners ({{ learning_styles['reading_writing'] }})</h3>
                <ul style="color: #c4d1ff; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                    <li>Provide written instructions and materials</li>
                    <li>Encourage note-taking and journaling</li>
                    <li>Assign writing tasks and essays</li>
                    <li>Use lists, outlines, and written summaries</li>
                    <li>Leverage PowerGrid for detailed study guides</li>
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <h2 style="color: #a78bfa; margin: 30px 0 20px 0;">üë• Individual Student Profiles</h2>
    <div class="students-grid">
        {% for item in students_data %}
        <div class="student-card {% if not item.has_profile %}no-profile{% endif %}">
            <div class="student-name">{{ item.student.name }}</div>

            {% if item.has_profile %}
                <div class="profile-badge">
                    {% if item.profile.primary_learning_style == 'visual' %}üëÅÔ∏è
                    {% elif item.profile.primary_learning_style == 'auditory' %}üëÇ
                    {% elif item.profile.primary_learning_style == 'kinesthetic' %}ü§∏
                    {% elif item.profile.primary_learning_style == 'reading_writing' %}üìù
                    {% endif %}
                    {{ item.profile.primary_learning_style.replace('_', ' ').title() }} Learner
                </div>

                <div class="profile-details">
                    <div class="detail-item">
                        <span class="detail-label">Focus Best:</span>
                        <span class="detail-value">{{ item.profile.focus_preference.replace('_', ' ').title() if item.profile.focus_preference else 'N/A' }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Best Study Time:</span>
                        <span class="detail-value">{{ item.profile.best_study_time.title() if item.profile.best_study_time else 'N/A' }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Needs Breaks:</span>
                        <span class="detail-value">{{ item.profile.break_frequency.replace('_', ' ').title() if item.profile.break_frequency else 'N/A' }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Processing:</span>
                        <span class="detail-value">{{ item.profile.processing_style.replace('_', ' ').title() if item.profile.processing_style else 'N/A' }}</span>
                    </div>
                </div>

                <div class="teaching-tips">
                    <h4>üí° TEACHING TIPS</h4>
                    {% if item.profile.primary_learning_style == 'visual' %}
                        <div class="tip-item">Use visual aids and diagrams</div>
                        <div class="tip-item">Color-code materials</div>
                        <div class="tip-item">Show videos and demonstrations</div>
                    {% elif item.profile.primary_learning_style == 'auditory' %}
                        <div class="tip-item">Include verbal explanations</div>
                        <div class="tip-item">Encourage discussion and reading aloud</div>
                        <div class="tip-item">Use audio resources</div>
                    {% elif item.profile.primary_learning_style == 'kinesthetic' %}
                        <div class="tip-item">Include hands-on activities</div>
                        <div class="tip-item">Allow movement breaks</div>
                        <div class="tip-item">Use physical manipulatives</div>
                    {% elif item.profile.primary_learning_style == 'reading_writing' %}
                        <div class="tip-item">Provide written materials</div>
                        <div class="tip-item">Encourage note-taking</div>
                        <div class="tip-item">Assign writing tasks</div>
                    {% endif %}

                    {% if item.profile.focus_preference in ['short_bursts', 'every_15_min'] %}
                        <div class="tip-item">Give shorter assignments with breaks</div>
                    {% endif %}

                    {% if item.profile.processing_style == 'step_by_step' %}
                        <div class="tip-item">Break tasks into clear steps</div>
                    {% elif item.profile.processing_style == 'big_picture' %}
                        <div class="tip-item">Show overview before details</div>
                    {% endif %}
                </div>
            {% else %}
                <div class="profile-badge no-profile-badge">‚ö†Ô∏è No Profile Yet</div>
                <p class="no-profile-message">This student hasn't completed the Learning Lab quiz yet. Encourage them to take it to unlock personalized learning strategies!</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
